<!DOCTYPE html>
<html>
<head>
    <title>Enterprise ERP | Master Command</title>
    <script src="nav.js"></script>
    <style>
        :root { --primary: #6366f1; --danger: #ef4444; --success: #10b981; --dark: #1e293b; }
        .biz-layout { display: grid; grid-template-columns: 280px 1fr 1fr; gap: 20px; align-items: start; }
        
        /* Sidebar Quick Options */
        .option-card { 
            background: white; border: 1px solid #e2e8f0; padding: 12px; border-radius: 12px;
            display: flex; align-items: center; gap: 12px; margin-bottom: 10px;
            cursor: pointer; text-decoration: none; color: var(--dark); transition: 0.2s;
        }
        .option-card:hover { transform: translateX(5px); border-color: var(--primary); background: #f8fafc; }
        .opt-icon { width: 35px; height: 35px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; }

        .stat-card { background: white; padding: 18px; border-radius: 16px; border: 1px solid #f1f5f9; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); position: relative; }
        .kpi-dark { background: var(--dark); color: white; border: none; }
        
        .dash-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        .dash-table td { padding: 10px 0; border-bottom: 1px solid #f8fafc; }
        
        .debt-row { display: flex; justify-content: space-between; padding: 8px; background: #fff1f2; border-radius: 8px; margin-bottom: 5px; border-left: 4px solid var(--danger); font-size: 0.8rem; }
        .section-label { color: #94a3b8; font-weight: 800; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; display: block; }

        .pager { display: flex; justify-content: space-between; margin-top: 10px; }
        .pager button { border: 1px solid #e2e8f0; background: white; border-radius: 4px; padding: 2px 8px; cursor: pointer; font-size: 0.65rem; }
        
        /* Logo Upload Styling */
        #logoPreview { max-height: 60px; max-width: 180px; object-fit: contain; }
    </style>
</head>
<body>
    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; background: white; padding: 15px; border-radius: 15px; border: 1px solid #f1f5f9;">
            <div style="display:flex; align-items:center; gap:15px;">
                <div id="logoContainer" onclick="document.getElementById('logoInput').click()" style="cursor:pointer; border: 2px dashed #cbd5e1; padding: 5px; border-radius: 10px;">
                    <img id="logoPreview" src="" style="display:none;">
                    <span id="logoPlaceholder" style="font-size: 0.7rem; color: #94a3b8;">Click to Upload Logo</span>
                </div>
                <input type="file" id="logoInput" style="display:none;" accept="image/*" onchange="updateLogo(this)">
                <div>
                    <h1 style="margin:0; font-size:1.4rem; letter-spacing:-1px;" id="displayBizName">Company Name</h1>
                    <p id="currentDate" style="color:#64748b; margin:0; font-size:0.75rem; font-weight:bold;"></p>
                </div>
            </div>
            <button class="btn" onclick="location.reload()" style="padding: 8px 15px;">üîÑ Refresh Live</button>
        </div>

        <div class="biz-layout">
            
            <div>
                <span class="section-label">Quick Launch</span>
                <a href="pos.html" class="option-card"><div class="opt-icon" style="background:#e0e7ff; color:#6366f1;">üõí</div><b>POS Terminal</b></a>
                <a href="inventory.html" class="option-card"><div class="opt-icon" style="background:#dcfce7; color:#10b981;">üì¶</div><b>Stock Manager</b></a>
                <a href="customers.html" class="option-card"><div class="opt-icon" style="background:#fef3c7; color:#f59e0b;">üë•</div><b>Customer Ledger</b></a>
                <a href="settings.html" class="option-card"><div class="opt-icon" style="background:#f1f5f9; color:#475569;">‚öôÔ∏è</div><b>Settings</b></a>

                <div class="stat-card kpi-dark" style="margin-top:20px;">
                    <small style="color:#94a3b8;">DAILY REVENUE</small>
                    <h2 id="daySales" style="margin:5px 0 15px 0; color:#38bdf8;">$0.00</h2>
                    <small style="color:#94a3b8;">INVENTORY VALUE</small>
                    <h3 id="totalInvValue" style="margin:5px 0 0 0; color:var(--success);">$0.00</h3>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:20px;">
                <div class="stat-card">
                    <span class="section-label">üèÜ Top 5 Best Sellers</span>
                    <div id="top5Sales"></div>
                </div>

                <div class="stat-card" style="border-top: 4px solid var(--danger);">
                    <span class="section-label" style="color:var(--danger);">üî¥ Top 5 Debtors</span>
                    <div id="top5Debtors"></div>
                </div>
                
                <div class="stat-card" style="border-left: 4px solid var(--danger);">
                    <span class="section-label">‚ö†Ô∏è Low Stock Alerts</span>
                    <div id="lowStockList" style="font-size:0.8rem;"></div>
                </div>
            </div>

            <div style="display:flex; flex-direction:column; gap:20px;">
                <div class="stat-card">
                    <span class="section-label">üìù Recent Sales</span>
                    <table class="dash-table"><tbody id="salesFeed"></tbody></table>
                    <div class="pager">
                        <button onclick="nav('sales', -1)">PREV</button>
                        <span id="salesPage" style="font-size:0.6rem;">P.1</span>
                        <button onclick="nav('sales', 1)">NEXT</button>
                    </div>
                </div>

                <div class="stat-card">
                    <span class="section-label">üÜï Recently Added Stock</span>
                    <table class="dash-table"><tbody id="stockFeed"></tbody></table>
                    <div class="pager">
                        <button onclick="nav('stock', -1)">PREV</button>
                        <span id="stockPage" style="font-size:0.6rem;">P.1</span>
                        <button onclick="nav('stock', 1)">NEXT</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

<script>
    let pSales = 0, pStock = 0;
    const limit = 5;

    function updateLogo(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const biz = JSON.parse(localStorage.getItem('bizProfile')) || {};
                biz.logo = e.target.result;
                localStorage.setItem('bizProfile', JSON.stringify(biz));
                refreshDashboard();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    function refreshDashboard() {
        const biz = JSON.parse(localStorage.getItem('bizProfile')) || { name: "My Business", currency: "$" };
        const inv = JSON.parse(localStorage.getItem('myInventory')) || [];
        const sales = JSON.parse(localStorage.getItem('salesHistory')) || [];
        const custs = JSON.parse(localStorage.getItem('customers')) || [];
        const sym = biz.currency || "$";

        // Brand Setup
        document.getElementById('displayBizName').innerText = biz.name;
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('en-GB', { weekday: 'long', day: 'numeric', month: 'long' });
        if(biz.logo) {
            document.getElementById('logoPreview').src = biz.logo;
            document.getElementById('logoPreview').style.display = 'block';
            document.getElementById('logoPlaceholder').style.display = 'none';
        }

        // Calculations
        const todayStr = new Date().toLocaleDateString();
        const dailyRev = sales.filter(s => s.date === todayStr).reduce((acc, curr) => acc + curr.total, 0);
        const totalValue = inv.reduce((acc, curr) => acc + (curr.qty * (curr.cp || 0)), 0);
        document.getElementById('daySales').innerText = sym + dailyRev.toLocaleString();
        document.getElementById('totalInvValue').innerText = sym + totalValue.toLocaleString();

        // Low Stock
        const lowItems = inv.filter(i => i.qty <= 5).slice(0, 5);
        document.getElementById('lowStockList').innerHTML = lowItems.map(i => `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                <span>${i.name}</span><b style="color:var(--danger);">${i.qty}</b>
            </div>`).join('') || 'All levels OK';

        // Top 5 Sales
        const map = {};
        sales.forEach(s => s.items.forEach(i => map[i.name] = (map[i.name] || 0) + i.qty));
        const t5S = Object.entries(map).sort((a,b) => b[1] - a[1]).slice(0, 5);
        document.getElementById('top5Sales').innerHTML = t5S.map(p => `
            <div style="display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid #f8fafc; font-size:0.8rem;">
                <span>${p[0]}</span><b>${p[1]} units</b>
            </div>`).join('') || 'No sales';

        // Top 5 Debtors
        const t5D = [...custs].filter(c => c.balance > 0).sort((a,b) => b.balance - a.balance).slice(0, 5);
        document.getElementById('top5DebtorsList').innerHTML = t5D.map(c => `
            <div class="debt-row"><span>${c.name}</span><b>${sym}${c.balance.toFixed(2)}</b></div>
        `).join('') || 'No debt';

        // Paginated Feeds
        renderFeed('sales', [...sales].reverse(), 'salesFeed', 'salesPage', pSales, sym);
        renderFeed('stock', [...inv].reverse(), 'stockFeed', 'stockPage', pStock, sym);
    }

    function renderFeed(type, data, target, pageText, currentIdx, sym) {
        const start = currentIdx * limit;
        const slice = data.slice(start, start + limit);
        document.getElementById(pageText).innerText = `Page ${currentIdx + 1}`;
        document.getElementById(target).innerHTML = slice.map(item => {
            if(type === 'sales') return `<tr><td style="color:#94a3b8;">#${item.id.slice(-4)}</td><td><b>${sym}${item.total}</b></td><td style="text-align:right; font-size:0.6rem;">${item.method}</td></tr>`;
            return `<tr><td>${item.name}</td><td style="text-align:right;"><b>${item.qty}</b></td></tr>`;
        }).join('') || "<tr><td>End of data</td></tr>";
    }

    window.nav = (type, dir) => {
        if(type === 'sales') pSales = Math.max(0, pSales + dir);
        else pStock = Math.max(0, pStock + dir);
        refreshDashboard();
    };

    window.addEventListener('storage', refreshDashboard);
    refreshDashboard();
</script>
</body>
</html>